<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Biosecurity working example • mrIML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Biosecurity working example">
<meta property="og:description" content="mrIML">
<meta property="og:image" content="">
<meta property="og:image:alt" content="Multivariate–multi-response–interpretable machine learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@gustavoetal">
<meta name="twitter:site" content="@gustavoetal">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mrIML</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Vignette_biosecurity.html">Swine Biosecurity working example</a>
    </li>
    <li>
      <a href="../articles/Vignette_classification.html">Classification working example</a>
    </li>
    <li>
      <a href="../articles/Vignette_regression.html">Regression working example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Vignette_biosecurity_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Biosecurity working example</h1>
                        <h4 data-toc-skip class="author">Abagael Sykes, Gustavo Machado</h4>
            
            <h4 data-toc-skip class="date">2021-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/nfj1380/mrIML/blob/HEAD/vignettes/Vignette_biosecurity.Rmd" class="external-link"><code>vignettes/Vignette_biosecurity.Rmd</code></a></small>
      <div class="hidden name"><code>Vignette_biosecurity.Rmd</code></div>

    </div>

    
    
<div class="section level1">
<h1 id="general-introduction">General introduction<a class="anchor" aria-label="anchor" href="#general-introduction"></a>
</h1>
<p>MrIML is a R package allows users to generate and interpret multi-response models (i.e., joint species distribution models) leveraging advances in data science and machine learning. MrIML couples the tidymodel infrastructure developed by Max Kuhn and colleagues with model agnostic interpretable machine learning tools to gain insights into multiple response data such as. As such MrIML is flexible and easily extendable allowing users to construct everything from simple linear models to tree-based methods for each response using the same syntax and same way to compare predictive performance.In this vignette we will guide you through how to apply the MrIML framework to identify and benchmark biosecurity practices in veterinary disease. This working example is built upon a classification framework. More information about this can be found in the “Classification working example”.</p>
<div class="section level3">
<h3 id="lets-load-that-data">Lets load that data<a class="anchor" aria-label="anchor" href="#lets-load-that-data"></a>
</h3>
<p>This is a synthesized dataset to simulate PRRSV infection, biosecurity practices and farm demographics on swine farms across the united states. Please note that the data included in this package is simulated, and is not a reflection of any real farm, company or state.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#other packages needed</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nfj1380.github.io/mrIML" class="external-link">mrIML</a></span><span class="op">)</span>;<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://parsnip.tidymodels.org" class="external-link">parsnip</a></span><span class="op">)</span>;
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org" class="external-link">tidymodels</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows" class="external-link">workflows</a></span><span class="op">)</span>;
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mayer79/flashlight" class="external-link">flashlight</a></span><span class="op">)</span>;
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dalex.drwhy.ai" class="external-link">DALEX</a></span><span class="op">)</span>; 
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span>;<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/koalaverse/vip/" class="external-link">vip</a></span><span class="op">)</span>;
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nanx.me/ggsci/" class="external-link">ggsci</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span>;
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pbiecek.github.io/breakDown/" class="external-link">breakDown</a></span><span class="op">)</span>; <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span>;
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sfirke/janitor" class="external-link">janitor</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">130</span><span class="op">)</span> <span class="co">#set the seed to ensure consistency</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu">mrIML</span><span class="fu">::</span><span class="va">biosecurity_vignette_data</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="defining-your-model-engine">Defining your model engine<a class="anchor" aria-label="anchor" href="#defining-your-model-engine"></a>
</h3>
<p>This is a random forest model, as used in the classification example. However there are more models available within MrIML and can be found <a href="https://www.tidymodels.org/find/" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#split predictor variables and outcome</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">44</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="co">#remove class, group and ID</span>
<span class="va">model1</span> <span class="op">&lt;-</span> <span class="co">#model used to generate yhat</span>
  <span class="co">#specify that the model is a random forest</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/rand_forest.html" class="external-link">rand_forest</a></span><span class="op">(</span>trees <span class="op">=</span> <span class="fl">100</span>, mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, min_n <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, mode <span class="op">=</span> <span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="co">#select the engine/package that underlies the model</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"ranger"</span>, importance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"impurity"</span>,<span class="st">"impurity_corrected"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="co">#must be set to classification for classification problems</span>
  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></code></pre></div>
<p>###Parallel processing</p>
<p>MrIML provides uses the flexible future apply functionality to set up multi-core processing. In the example below, we set up a cluster using 4 cores. If you don’t set up a cluster, the default settings will be used and the analysis will run sequentially.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># detectCores() #check how many cores you have available. We suggest keeping one core free for internet browsing etc.</span>

<span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">cluster</span>, workers<span class="op">=</span><span class="va">cl</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-the-analyis">Running the analyis<a class="anchor" aria-label="anchor" href="#running-the-analyis"></a>
</h3>
<p>Now we can train and test our model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yhats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLpredicts.html">mrIMLpredicts</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">X</span>, <span class="co">#features/predictors </span>
                       Y<span class="op">=</span><span class="va">Y</span>, <span class="co">#response data</span>
                       Model<span class="op">=</span><span class="va">model1</span>, <span class="co">#specify your model</span>
                       balance_data<span class="op">=</span><span class="st">'no'</span>, <span class="co">#chose how to balance your data </span>
                       mode<span class="op">=</span><span class="st">'classification'</span>, <span class="co">#chose your mode (classification versus regression)</span>
                       seed <span class="op">=</span> <span class="fl">120</span><span class="op">)</span> <span class="co">#set seed</span></code></pre></div>
<p>We can then assess our model performance using a number of performance metrics including area under the curve (AUC), sensitivity, specificity and Matthews correlation coefficient (MCC).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ModelPerf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrIMLperformance.html">mrIMLperformance</a></span><span class="op">(</span>yhats<span class="op">=</span><span class="va">yhats</span>, Model<span class="op">=</span><span class="va">model1</span>, Y<span class="op">=</span><span class="va">Y</span>, mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span>
<span class="va">ModelPerf</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co">#predictive performance for individual responses </span>
<span class="co">#&gt;   response  model_name           roc_AUC               mcc       sensitivity</span>
<span class="co">#&gt; 1    Class rand_forest 0.658615136876006 0.269515754526925 0.740740740740741</span>
<span class="co">#&gt;         specificity prevalence</span>
<span class="co">#&gt; 1 0.521739130434783        0.5</span>
<span class="va">ModelPerf</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="co">#overall predictive performance. r2 for regression and MCC for classification</span>
<span class="co">#&gt; [1] 0.6586151</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="benchmarking-global-importance">Benchmarking: global importance<a class="anchor" aria-label="anchor" href="#benchmarking-global-importance"></a>
</h3>
<p>Here we can look at the variable importance. This is the dependence between our outcome and biosecurity variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#calculate variable importance</span>
<span class="va">VI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrVip.html">mrVip</a></span><span class="op">(</span>yhats<span class="op">=</span><span class="va">yhats</span>, X<span class="op">=</span><span class="va">X</span><span class="op">)</span>
<span class="co">#plot cumulative variable importance </span>
<span class="fu"><a href="../reference/plot_vi_biosecurity.html">plot_vi_biosecurity</a></span><span class="op">(</span>VI<span class="op">=</span><span class="va">VI</span>, Y<span class="op">=</span><span class="va">Y</span>, X<span class="op">=</span><span class="va">X</span>,
        modelPerf<span class="op">=</span><span class="va">ModelPerf</span>,
        cutoff<span class="op">=</span> <span class="fl">0.6</span>,
        plot.pca<span class="op">=</span><span class="st">'no'</span><span class="op">)</span> <span class="co">#Follow instructions in console</span></code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/variable%20importance-1.png" width="1248"></p>
<pre><code><span class="co">#&gt; Press [enter] to plot individual variable importance summaries</span>
<span class="co">#&gt; [1] ""</span></code></pre>
<p>We can explore further and assess the partial dependence of each variable. Here we isolate the dependence of one variable and visualize how this dependence changes over different observed values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#create a flashlight object</span>
<span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mrFlashlight.html">mrFlashlight</a></span><span class="op">(</span>yhats<span class="op">=</span><span class="va">yhats</span>, X<span class="op">=</span><span class="va">X</span>, Y<span class="op">=</span><span class="va">Y</span>, 
                   response<span class="op">=</span><span class="st">"single"</span>, 
                   index<span class="op">=</span><span class="fl">1</span>,
                   mode<span class="op">=</span><span class="st">'classification'</span><span class="op">)</span> 
<span class="co">#plot partial dependence profiles</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/flashlight/man/light_profile.html" class="external-link">light_profile</a></span><span class="op">(</span><span class="va">fl</span>, v <span class="op">=</span> <span class="st">"Premises_in_3_miles"</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/pdp-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="benchmarking-predicted-risk">Benchmarking: predicted risk<a class="anchor" aria-label="anchor" href="#benchmarking-predicted-risk"></a>
</h3>
<p>The following function allows you to visualize and compare predicted risk among and within groups</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#apply the trained model to the entire data set to provide risk of predicted outbreak</span>
<span class="va">fit_bio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://workflows.tidymodels.org//reference/workflow-extractors.html" class="external-link">pull_workflow_fit</a></span><span class="op">(</span><span class="va">yhats</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">mod1_k</span><span class="op">)</span>
<span class="va">preds_pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_bio</span>, <span class="va">data</span>, <span class="st">"prob"</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">Predicted</span> <span class="op">&lt;-</span> <span class="va">preds_pos</span><span class="op">$</span><span class="va">.pred_1</span>
<span class="co">#process data ready for the function</span>
<span class="va">data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span>
<span class="va">data</span><span class="op">&lt;-</span><span class="va">data</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/revalue.html" class="external-link">revalue</a></span><span class="op">(</span><span class="va">Class</span>,
                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Positive"</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="st">"Negative"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="va">data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Class</span>, <span class="st">"Positive"</span><span class="op">)</span>
<span class="va">data1</span> <span class="op">&lt;-</span> <span class="va">data</span>
<span class="co">#plot among group comparison of predicted risk</span>
<span class="fu"><a href="../reference/mrBenchmark.html">mrBenchmark</a></span><span class="op">(</span>data <span class="op">=</span> <span class="st">"data1"</span>, Y <span class="op">=</span> <span class="st">"Class"</span>, pred <span class="op">=</span> <span class="st">"Predicted"</span>, group <span class="op">=</span> <span class="st">"Group"</span>, type <span class="op">=</span> <span class="st">"external"</span><span class="op">)</span> </code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-4-1.png" width="1248"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#plot within group comparison of predicted risk</span>
<span class="fu"><a href="../reference/mrBenchmark.html">mrBenchmark</a></span><span class="op">(</span>data <span class="op">=</span> <span class="st">"data1"</span>, Y <span class="op">=</span> <span class="st">"Class"</span>, pred <span class="op">=</span> <span class="st">"Predicted"</span>, group <span class="op">=</span> <span class="st">"Group"</span>, label_by <span class="op">=</span> <span class="st">"ID"</span>, type <span class="op">=</span> <span class="st">"internal"</span><span class="op">)</span> </code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-1.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-2.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-3.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-4.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-5.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-6.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-7.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-8.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-9.png" width="700"><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-5-10.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="benchmarking-local-importance">Benchmarking: local importance<a class="anchor" aria-label="anchor" href="#benchmarking-local-importance"></a>
</h3>
<p>To investigate and interpret the contribution of variables at an individual level, we must use a local explanation method. Here we implement a local breakDown explainer. <code>mrLocalExplainer</code> produces both aggregated and individual results of variable contribution. Variables with a phi &gt; 0 contribute to an increase in predicted PRRSV outbreak risk, while variables with a phi &lt; 0 contribute to a decrease in predicted outbreak risk.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Use this function to implement the local explainer </span>
<span class="va">data</span><span class="op">&lt;-</span><span class="va">data</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/revalue.html" class="external-link">revalue</a></span><span class="op">(</span><span class="va">Class</span>,
                         <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span> <span class="op">=</span> <span class="st">"Positive"</span>, <span class="st">"0"</span> <span class="op">=</span> <span class="st">"Negative"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> 
<span class="va">data</span><span class="op">$</span><span class="va">Class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/relevel.html" class="external-link">relevel</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Class</span>, <span class="st">"Positive"</span><span class="op">)</span>
<span class="va">X1</span> <span class="op">&lt;-</span> <span class="va">X</span>
<span class="fu"><a href="../reference/mrLocalExplainer.html">mrLocalExplainer</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">X1</span>, Model <span class="op">=</span> <span class="va">yhats</span>, Y <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span>
<span class="co">#&gt; Preparation of a new explainer is initiated</span>
<span class="co">#&gt;   -&gt; model label       :  ranger  ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="co">#&gt;   -&gt; data              :  200  rows  42  cols </span>
<span class="co">#&gt;   -&gt; target variable   :  not specified! ( <span style="color: #BB0000;"> WARNING </span> )</span>
<span class="co">#&gt;   -&gt; predict function  :  yhat.ranger  will be used ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="co">#&gt;   -&gt; predicted values  :  No value for predict function target column. ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="co">#&gt;   -&gt; model_info        :  package ranger , ver. 0.13.1 , task classification ( <span style="color: #BBBB00;"> default </span> ) </span>
<span class="co">#&gt;   -&gt; model_info        :  Model info detected classification task but 'y' is a NULL .  ( <span style="color: #BB0000;"> WARNING </span> )</span>
<span class="co">#&gt;   -&gt; model_info        :  By deafult classification tasks supports only numercical 'y' parameter. </span>
<span class="co">#&gt;   -&gt; model_info        :  Consider changing to numerical vector with 0 and 1 values.</span>
<span class="co">#&gt;   -&gt; model_info        :  Otherwise I will not be able to calculate residuals or loss function.</span>
<span class="co">#&gt;   -&gt; predicted values  :  numerical, min =  0.160133 , mean =  0.5113279 , max =  0.8878627  </span>
<span class="co">#&gt;   -&gt; residual function :  difference between y and yhat ( <span style="color: #BBBB00;"> default </span> )</span>
<span class="co">#&gt;  <span style="color: #00BB00;"> A new explainer has been created! </span></span></code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-6-1.png" width="1440"></p>
<p>Individual plots are produced in the list object <code>LE_indiv_plots</code>. Each plot corresponds to a single farm. An example of a positive farm and a negative farm are shown here.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LE_indiv_plots</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="co">#&gt; [[1]]</span></code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-7-1.png" width="1248"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">LE_indiv_plots</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="co">#&gt; [[1]]</span></code></pre></div>
<p><img src="Vignette_biosecurity_files/figure-html/unnamed-chunk-7-2.png" width="1248"> At the positive farm we can see that yards from the public road and garbage collection are contributing to an increased outbreak risk, while manure removals and repair visits are contributing to a decreased outbreak risk. Likewise, at the negative farm yards to the public road and and the downtime required for manure removal personnel are contributing to an increased outbreak risk, while feed deliveries and manure removals are contributing to a decreased outbreak risk.</p>
<p>This session of the MrIML has been funded by Critical Agricultural Research and Extension 2019-68008-29910 from the USDA National Institute of Food and Agriculture.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nick Fountain-Jones, Nicholas Clark, Chris Kozakiewicz, <a href="https://machado-lab.github.io/" class="external-link">Gustavo Machado</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
